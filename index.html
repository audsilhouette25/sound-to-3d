<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>IML Research - GPU & ML Integration</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
    <script src="https://unpkg.com/ml5@0.12.2/dist/ml5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/utils/BufferGeometryUtils.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="ui-container">
        <div id="header-section">
            <h1 id="title">IML Research</h1>
            <button id="lang-toggle" onclick="toggleLanguage()">EN</button>
        </div>
        
        <button id="btn-engine" onclick="initEngine()"></button>

        <div id="data-display">
            <p><span id="label-loud">Loudness</span> <span id="val-loud">0.00</span></p>
            <p><span id="label-pitch">Pitch</span> <span id="val-pitch">0.00</span></p>
            <p><span id="label-bright">Brightness</span> <span id="val-bright">0.00</span></p>
            <p><span id="label-rough">Roughness</span> <span id="val-rough">0.00</span></p>
        </div>

        <button id="btn-main" onclick="handleRecord()" style="display:none; margin-top:15px;"></button>
        <button id="btn-upload" onclick="document.getElementById('file-input').click()" style="display:none; margin-top:10px;"></button>
        <input type="file" id="file-input" accept="audio/*" style="display:none;" onchange="handleFileUpload(event)">
        <button id="btn-play" onclick="togglePlayback()" style="display:none;"></button>

        <div id="labeling-zone" style="display:none; margin-top:20px;">
            <p id="labeling-instruction" style="font-size: 0.75rem; color:#00ffcc; text-align:center;"></p>
            <div class="slider-group">
                <div class="slider-header"><span id="y1-left"></span><span id="y1-label"></span><span id="y1-right"></span></div>
                <input type="range" id="y1" min="0" max="1" step="0.01" value="0.5">
            </div>
            <div class="slider-group">
                <div class="slider-header"><span id="y2-left"></span><span id="y2-label"></span><span id="y2-right"></span></div>
                <input type="range" id="y2" min="0" max="1" step="0.01" value="0.5">
            </div>
            <div class="slider-group">
                <div class="slider-header"><span id="y3-left"></span><span id="y3-label"></span><span id="y3-right"></span></div>
                <input type="range" id="y3" min="0" max="1" step="0.01" value="0.5">
            </div>
            <div class="slider-group">
                <div class="slider-header"><span id="y4-left"></span><span id="y4-label"></span><span id="y4-right"></span></div>
                <input type="range" id="y4" min="0" max="1" step="0.01" value="0.5">
            </div>

            <div class="slider-group">
                <div class="slider-header"><span id="shape-label"></span><span id="shape-name">Sphere</span></div>
                <input type="range" id="shape-selector" min="0" max="4" step="1" value="0" oninput="changeShape(this.value)">
            </div>

            <button id="btn-confirm" onclick="confirmTrainingWrapper()" style="background:#00ffcc; color:black; margin-top:10px;"></button>
        </div>
        
        <div id="save-load-zone" style="margin-top:auto; padding-top:15px; border-top:1px solid #333; display:none;">
            <p style="text-align:center; font-size:0.85em; color:#888;">
                <span id="data-label"></span> <span id="data-count">0</span> <span id="samples-label"></span>
            </p>
            <button id="btn-export" onclick="exportCSV()" style="background:#222; color:#888; font-size:0.75em;"></button>
            <button id="btn-clear" onclick="clearAllData()" style="background:#441111; color:#ff6666; font-size:0.75em; margin-top:5px;"></button>
        </div>
    </div>

    <!-- Training Progress Overlay -->
    <div id="training-overlay" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.8); z-index:9999; justify-content:center; align-items:center; flex-direction:column;">
        <div style="text-align:center; color:#00ffcc;">
            <div id="training-message" style="font-size:1.5em; font-weight:bold; margin-bottom:15px;">Training AI Model...</div>
            <div id="training-progress" style="font-size:1em; color:#888;">This may take a few seconds</div>
        </div>
    </div>

    <div id="three-container"></div>
    <script src="sketch.js"></script>
</body>
</html>
